apiVersion: batch/v1
kind: Job
metadata:
  name: migrate
  namespace: payment-gateway
spec:
  template:
    spec:
      containers:
      - name: migrate
        image: migrate:1.0
        envFrom:
        - configMapRef:
            name: app-config
        - secretRef:
            name: app-secrets
        env:
        - name: APP_ENV
          value: "kubernetes"
        - name: DB_URL
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: DB_URL
      restartPolicy: OnFailure
